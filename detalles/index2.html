<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Dashboard General</title>
  <link rel="stylesheet" href="styles.css">
</head>
<body>
  <nav>
    <a href="index.html">Dashboard</a> |
    <a href="master.html">Panel Master</a> |
    <a href="cnc.html">CNC</a> |
    <a href="molino.html">Molino</a> |
    <a href="lija.html">Lija</a> |
    <a href="ensamble.html">Ensamble</a> |
    <a href="pintura.html">Pintura</a>
  </nav>

  <h1>Dashboard General</h1>

  <input type="text" id="buscador" placeholder="Buscar WO..." onkeyup="filtrarWO()">

  <table id="tablaDashboard">
    <thead>
      <tr>
        <th>ID</th>
        <th>Descripci√≥n</th>
        <th>Piezas</th>
        <th>Clasificaci√≥n</th>
        <th>Estado / Estaci√≥n</th>
        <th>Acci√≥n</th>
      </tr>
    </thead>
    <tbody id="tabla-dashboard"></tbody>
  </table>

  <script src="script.js"></script>
  <script>
    document.addEventListener("DOMContentLoaded", actualizarDashboard);

    function actualizarDashboard() {
      const allWOs = JSON.parse(localStorage.getItem("workOrders")) || [];
      const tbody = document.getElementById("tabla-dashboard");
      tbody.innerHTML = "";

      allWOs.forEach(wo => {
        const tr = document.createElement("tr");
        tr.innerHTML = `
          <td>${wo.id}</td>
          <td>${wo.descripcion}</td>
          <td>${wo.piezas}</td>
          <td>${wo.clasificacion}</td>
          <td>${wo.estado}</td>
          <td><button class="btn-ver" onclick="window.location.href='wo_detail.html?id=${wo.id}'">Ver Detalles</button></td>


          </td>
        `;
        tbody.appendChild(tr);
      });
    }

    function verDetalle(id) {
      localStorage.setItem("detalleWO", id);
      window.location.href = "wo_detail.html";
    }

    function filtrarWO() {
      const filtro = document.getElementById("buscador").value.toLowerCase();
      const filas = document.querySelectorAll("#tabla-dashboard tbody tr");
      filas.forEach(fila => {
        const texto = fila.textContent.toLowerCase();
        fila.style.display = texto.includes(filtro) ? "" : "none";
      });
    }
function asignarEstacion(index) {
  const select = document.getElementById(`select-${index}`);
  const nueva = select.value;
  const allWOs = JSON.parse(localStorage.getItem("workOrders")) || [];

  if (!allWOs[index]) return;

  allWOs[index].estado = nueva;
  allWOs[index].historial = (allWOs[index].historial || "") + ` ‚Üí ${nueva} (${new Date().toLocaleString()})`;

  localStorage.setItem("workOrders", JSON.stringify(allWOs));
  mostrarTablaMaster();

  guardarCambiosEnSharePoint(); // üîÅ Env√≠a los cambios al Excel remoto
}


  </script>
</body>
</html>
